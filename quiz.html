<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz Contest — HTML + JavaScript (fixed)</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#4f46e5;--correct:#10b981;--wrong:#ef4444}
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{margin:0;background:linear-gradient(180deg,#071028 0%, #081026 100%);color:#e6eef6;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .app{width:100%;max-width:900px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:20px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    h1{font-size:20px;margin:0}
    .meta{color:var(--muted);font-size:13px}
    .top-row{display:flex;gap:12px;align-items:center}
    .score{background:#061026;padding:10px;border-radius:8px;min-width:120px;text-align:center}

    /* Progress bars */
    .progress{height:10px;background:#071730;border-radius:999px;overflow:hidden}
    .progress.timer{height:8px;margin-bottom:8px}
    .progress.global{height:10px;margin-bottom:12px}
    .progress > i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--accent),#06b6d4);transition:width .18s linear}

    .question-area{margin-top:8px}
    .qnum{color:var(--muted);font-size:13px}
    .qtext{font-size:18px;margin:12px 0}
    .choices{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .choice{background:#061426;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);cursor:pointer;transition:transform .06s,box-shadow .06s}
    .choice:hover{transform:translateY(-3px)}
    .choice.disabled{opacity:.6;cursor:default}
    .choice.correct{outline:3px solid rgba(16,185,129,0.12);box-shadow:0 6px 20px rgba(16,185,129,0.06)}
    .choice.wrong{outline:3px solid rgba(239,68,68,0.12)}
    footer{display:flex;justify-content:space-between;align-items:center;margin-top:16px}
    button{background:var(--accent);color:white;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
    .small{font-size:13px;color:var(--muted)}
    .timer{display:flex;gap:8px;align-items:center}
    .final{padding:18px;text-align:center}
    .breakdown{margin-top:12px;text-align:left;background:#061126;padding:12px;border-radius:8px}
    pre{white-space:pre-wrap;word-break:break-word;background:#051223;padding:12px;border-radius:8px;color:#cfe9ff}
    @media(max-width:640px){.choices{grid-template-columns:1fr}.score{min-width:90px}}
  </style>
</head>
<body>
  <div class="app card">
    <header>
      <div>
        <h1>Quiz Contest — 100 marks per question</h1>
        <div class="meta">Each question total = 100 marks. Correct answer = base 50 marks. Remaining 50 = time bonus based on how fast you answer.</div>
      </div>
      <div class="top-row">
        <div class="score">
          <div class="small">Score</div>
          <div id="scoreVal" style="font-size:20px;font-weight:700">0</div>
        </div>
      </div>
    </header>

    <!-- Timer progress (per-question) -->
    <div class="progress timer" aria-hidden="true"><i id="timerProgress"></i></div>
    <!-- Global progress (overall quiz progress) -->
    <div class="progress global" aria-hidden="true"><i id="globalProgress"></i></div>

    <div id="main" class="question-area"></div>

    <footer>
      <div class="timer small">Time left: <strong id="timeLeft">--</strong> s</div>
      <div>
        <button id="nextBtn" class="ghost" style="display:none">Next →</button>
        <button id="restartBtn" style="display:none">Restart</button>
      </div>
    </footer>

    <div id="finalArea" style="display:none" class="final">
      <h2>Quiz complete</h2>
      <div id="finalScore" style="font-size:28px;font-weight:700">0 / 0</div>
      <div class="breakdown" id="breakdown"></div>
      <div style="margin-top:12px">
        <button id="downloadJson">Download questions JSON</button>
        <button id="playAgain" class="ghost">Play again</button>
      </div>
    </div>

  </div>

  <script>
    // ----- QUESTIONS JSON (includes right answer index) -----
    const QUESTIONS_JSON = [
      {"id":1,"q":"What is the capital of France?","options":["Paris","Berlin","Madrid","Rome"],"answer":0},
      {"id":2,"q":"Which language runs in a web browser?","options":["Python","C++","JavaScript","Java"],"answer":2},
      {"id":3,"q":"What does HTML stand for?","options":["Hyper Trainer Marking Language","HyperText Markup Language","HighText Machine Language","Hyperlink and Text Markup Language"],"answer":1},
      {"id":4,"q":"Which company developed the React library?","options":["Google","Facebook","Microsoft","Apple"],"answer":1},
      {"id":5,"q":"Which planet is known as the Red Planet?","options":["Earth","Mars","Jupiter","Venus"],"answer":1}
    ];

    // CONFIG
    const TIME_PER_Q = 20 * 1000; // milliseconds per question (change if you like)

    // STATE
    let currentIndex = 0;
    let score = 0;
    let startTime = null;
    let timerInterval = null;
    const results = []; // per-question result

    // UI refs
    const main = document.getElementById('main');
    const scoreVal = document.getElementById('scoreVal');
    const timeLeftEl = document.getElementById('timeLeft');
    const nextBtn = document.getElementById('nextBtn');
    const restartBtn = document.getElementById('restartBtn');
    const finalArea = document.getElementById('finalArea');
    const finalScore = document.getElementById('finalScore');
    const breakdown = document.getElementById('breakdown');
    const globalProgress = document.getElementById('globalProgress');
    const timerProgress = document.getElementById('timerProgress');

    // Start or restart the quiz
    function startQuiz(){
      currentIndex = 0;
      score = 0;
      results.length = 0;
      finalArea.style.display='none';
      document.getElementById('main').style.display='block';
      renderQuestion();
      updateScoreUI();
    }

    function renderQuestion(){
      clearInterval(timerInterval);
      const q = QUESTIONS_JSON[currentIndex];
      const qcount = QUESTIONS_JSON.length;
      document.querySelector('.meta').textContent = `Question ${currentIndex+1} of ${qcount} — Each question = 100 marks (50 base + 50 time bonus)`;

      const html = `
        <div class="qnum">Q${currentIndex+1} • ${q.id}</div>
        <div class="qtext">${escapeHtml(q.q)}</div>
        <div class="choices" role="list">
          ${q.options.map((opt,i)=>`<button class="choice" data-index="${i}" role="listitem">${escapeHtml(opt)}</button>`).join('')}
        </div>
      `;
      main.innerHTML = html;

      // attach listeners
      document.querySelectorAll('.choice').forEach(btn=>{
        btn.addEventListener('click', onAnswer);
      });

      // timer
      startTime = Date.now();
      timerInterval = setInterval(updateTimer, 100);
      updateTimer(); // immediate update so UI doesn't wait

      // update global progress bar (safe: function is defined)
      updateGlobalProgress();

      nextBtn.style.display='none';
      restartBtn.style.display='none';
    }

    function updateTimer(){
      const elapsed = Date.now() - startTime;
      const remaining = Math.max(0, TIME_PER_Q - elapsed);
      const remSec = Math.ceil(remaining / 1000);
      timeLeftEl.textContent = remSec;

      // timerProgress shows how much time remains for the current question
      const pctTime = Math.max(0, (remaining / TIME_PER_Q) * 100);
      timerProgress.style.width = pctTime + '%';

      if(remaining <= 0){
        clearInterval(timerInterval);
        handleTimeout();
      }
    }

    function onAnswer(e){
      const btn = e.currentTarget;
      if(btn.classList.contains('disabled')) return;
      const chosen = Number(btn.dataset.index);
      handleAnswer(chosen);
    }

    function handleAnswer(chosenIndex){
      clearInterval(timerInterval);
      const q = QUESTIONS_JSON[currentIndex];
      const elapsed = Date.now() - startTime; // ms
      const remaining = Math.max(0, TIME_PER_Q - elapsed);
      const timeRatio = remaining / TIME_PER_Q;

      const base = 50;
      const bonus = Math.round(50 * timeRatio); // 0..50 depending on remaining time
      let awarded = 0;
      const correct = chosenIndex === q.answer;
      if(correct){ awarded = base + bonus; score += awarded; }

      // record result
      results.push({
        id: q.id,
        question: q.q,
        chosen: q.options[chosenIndex] ?? null,
        correctAnswer: q.options[q.answer],
        correct: correct,
        base: base,
        bonus: correct ? bonus : 0,
        awarded: awarded,
        timeTakenMs: elapsed
      });

      // show feedback visually
      document.querySelectorAll('.choice').forEach(btn=>{
        const idx = Number(btn.dataset.index);
        btn.classList.add('disabled');
        if(idx === q.answer) btn.classList.add('correct');
        if(idx === chosenIndex && idx !== q.answer) btn.classList.add('wrong');
      });

      // show a small popup/line with awarded marks
      const info = document.createElement('div');
      info.style.marginTop='12px';
      info.style.fontSize='14px';
      info.innerHTML = correct ? `Correct — +${awarded} (base ${base} + time bonus ${bonus})` : `Wrong — +0. Correct answer: <strong>${escapeHtml(q.options[q.answer])}</strong>`;
      main.appendChild(info);

      updateScoreUI();

      // show next / end
      if(currentIndex < QUESTIONS_JSON.length - 1){
        nextBtn.style.display='inline-block';
        nextBtn.onclick = ()=>{ currentIndex++; renderQuestion(); };
      } else {
        restartBtn.style.display='inline-block';
        restartBtn.textContent='Show Results';
        restartBtn.onclick = finishQuiz;
      }
    }

    function handleTimeout(){
      // treat as wrong / zero points
      const q = QUESTIONS_JSON[currentIndex];
      results.push({id:q.id, question:q.q, chosen:null, correctAnswer:q.options[q.answer], correct:false, base:50, bonus:0, awarded:0, timeTakenMs: TIME_PER_Q});

      document.querySelectorAll('.choice').forEach(btn=>{
        const idx = Number(btn.dataset.index);
        btn.classList.add('disabled');
        if(idx === q.answer) btn.classList.add('correct');
      });

      const info = document.createElement('div');
      info.style.marginTop='12px';
      info.style.fontSize='14px';
      info.innerHTML = `Time's up — +0. Correct answer: <strong>${escapeHtml(q.options[q.answer])}</strong>`;
      main.appendChild(info);

      if(currentIndex < QUESTIONS_JSON.length - 1){
        nextBtn.style.display='inline-block';
        nextBtn.onclick = ()=>{ currentIndex++; renderQuestion(); };
      } else {
        restartBtn.style.display='inline-block';
        restartBtn.textContent='Show Results';
        restartBtn.onclick = finishQuiz;
      }
    }

    // Update the overall quiz progress bar
    function updateGlobalProgress(){
      const pct = Math.round((currentIndex / QUESTIONS_JSON.length) * 100);
      globalProgress.style.width = pct + '%';
    }

    function updateScoreUI(){
      scoreVal.textContent = score;
      // update global progress (delegated to helper)
      updateGlobalProgress();
    }

    function finishQuiz(){
      document.getElementById('main').style.display='none';
      finalArea.style.display='block';
      const totalPossible = QUESTIONS_JSON.length * 100;
      finalScore.textContent = `${score} / ${totalPossible}`;

      // build breakdown
      breakdown.innerHTML = '<strong>Per-question breakdown</strong>' + '<div style="margin-top:8px">' + results.map((r,i)=>{
        return `<div style="margin-bottom:8px;padding:8px;background:#051426;border-radius:8px">Q${i+1}: ${escapeHtml(r.question)}<br> Chosen: ${escapeHtml(String(r.chosen))} • Correct: ${escapeHtml(r.correctAnswer)} • Awarded: ${r.awarded} • Time taken: ${Math.ceil(r.timeTakenMs/1000)}s</div>`;
      }).join('') + '</div>';

      // attach download
      document.getElementById('downloadJson').onclick = ()=>{
        const blob = new Blob([JSON.stringify(QUESTIONS_JSON,null,2)],{type:'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'questions.json'; a.click(); URL.revokeObjectURL(url);
      };

      document.getElementById('playAgain').onclick = ()=>{ startQuiz(); };
    }

    // small helper
    function escapeHtml(str){ if(!str) return ''; return String(str).replace(/[&<>"']/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s])); }

    // start
    startQuiz();
  </script>
</body>
</html>
